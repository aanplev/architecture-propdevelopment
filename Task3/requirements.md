# Требования к внешним интеграциям с платформой «Умный дом»

## Требования к безопасности

1. **Шифрование данных в передаче**
    - Все взаимодействия с внешним API должны осуществляться по HTTPS (TLS 1.2+).
    - Обмен данными с мобильным приложением - только через внутренний шлюз (`SmartHome Gateway`).

2. **Изоляция данных**
    - Доступ к данным должен предоставляться только авторизованным пользователям, строго в рамках их прав.
    - Жильцы могут управлять только своими объектами (квартирами, паркингами и т.д.).

3. **Централизованная интеграция**
    - Все обращения к партнерскому API осуществляются исключительно через `SmartHome Gateway`.
    - Прямой доступ из мобильного приложения к внешнему API запрещён.

4. **Логирование и аудит**
    - Все входящие и исходящие вызовы логируются.
    - В логах фиксируются: идентификатор пользователя, действие, время, результат, ошибка (если есть).

5. **Ограничение частоты запросов**
    - Поддержка rate limiting и защита от DDoS на уровне шлюза и/или партнерской платформы.

6. **Подпись запросов**
    - Для критичных операций (открытие двери/шлагбаума) запросы должны быть подписаны с использованием HMAC или JWT.

7. **Актуальность прав**
    - При изменении прав доступа (например, смена владельца квартиры) - данные должны быть синхронизированы с партнерской платформой.

---

## Протоколы аутентификации и авторизации

1. **OAuth 2.0 / JWT**
    - Аутентификация пользователей осуществляется через PropDevelopment.
    - Внешний API принимает только запросы от `SmartHome Gateway` с валидным токеном.

2. **Ролевая авторизация (RBAC)**
    - Доступ к функциям (домофон/шлагбаум) зависит от:
        - статуса пользователя;
        - объекта проживания;
        - условий доступа (время, регламент и т.д.).

3. **TTL токенов и отзыв прав**
    - Токены имеют ограниченное время жизни.
    - В случае отзыва прав - токены аннулируются.

---
